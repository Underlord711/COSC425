<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weighted Undirected Graph Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.21.0/cytoscape.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <h1 class="text-3xl font-bold text-maroon-600">Weighted Undirected Graph Generator</h1>

    <div class="mt-6">
        <label for="numVertices" class="block font-semibold">Number of Vertices:</label>
        <input type="number" id="numVertices" min="4" required class="border border-gray-300 p-2 rounded w-full mt-2">
    </div>

    <div class="mt-6">
        <label for="weight1" class="block font-semibold">Weight for Edge Type 1:</label>
        <input type="number" id="weight1" value="1" required class="border border-gray-300 p-2 rounded w-full mt-2">
    </div>

    <div class="mt-6">
        <label for="weight2" class="block font-semibold">Weight for Edge Type 2:</label>
        <input type="number" id="weight2" value="2" required class="border border-gray-300 p-2 rounded w-full mt-2">
    </div>

    <div class="mt-6 space-x-4">
        <button onclick="generateGraph()" class="bg-maroon-600 text-white px-4 py-2 rounded hover:bg-maroon-700">Generate Graph</button>
        <button onclick="toggleMatrix()" id="matrixBtn" class="hidden bg-gold-500 text-white px-4 py-2 rounded hover:bg-gold-600">Show Matrix</button>
        <button onclick="downloadJSON()" id="downloadBtn" class="hidden bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">Download JSON</button>
    </div>

    <div class="mt-6">
        <input type="file" id="fileInput" accept=".json" class="border border-gray-300 p-2 rounded w-full">
        <button id="uploadBtn" onclick="uploadJSON()" class="hidden bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 mt-2">Upload JSON</button>
    </div>

    <h2 class="text-2xl font-semibold mt-10">Generated Graph:</h2>
    <table id="graphTable" class="hidden w-full border-collapse mt-4">
        <!-- The graph matrix will be dynamically generated here -->
    </table>
    <div id="cy" class="w-full h-96 border border-gray-300 mt-4"></div>

    <script>
        let graph = {};
        let isMatrixVisible = false;

        function generateGraph() {
            const numVertices = parseInt(document.getElementById('numVertices').value);
            const weight1 = parseFloat(document.getElementById('weight1').value);
            const weight2 = parseFloat(document.getElementById('weight2').value);

            graph = {};
            for (let i = 0; i < numVertices; i++) {
                const vertex = String.fromCharCode(65 + i);
                graph[vertex] = {};
            }

            const edgesCount = Array(numVertices).fill(0);
            const maxEdgesPerVertex = 3;
            const totalEdgesNeeded = (numVertices * maxEdgesPerVertex) / 2;

            let edgesCreated = 0;

            while (edgesCreated < totalEdgesNeeded) {
                let sourceIndex = Math.floor(Math.random() * numVertices);
                let destinationIndex;

                let attempts = 0;
                do {
                    destinationIndex = Math.floor(Math.random() * numVertices);
                    attempts++;
                    if (attempts > 100) {
                        console.log('Too many attempts to find a valid edge.');
                        break;
                    }
                } while (
                    destinationIndex === sourceIndex || 
                    edgesCount[sourceIndex] >= maxEdgesPerVertex ||
                    edgesCount[destinationIndex] >= maxEdgesPerVertex ||
                    graph[String.fromCharCode(65 + sourceIndex)][String.fromCharCode(65 + destinationIndex)]
                );

                if (edgesCount[sourceIndex] < maxEdgesPerVertex && edgesCount[destinationIndex] < maxEdgesPerVertex) {
                    const source = String.fromCharCode(65 + sourceIndex);
                    const destination = String.fromCharCode(65 + destinationIndex);
                    const weight = Math.random() < 0.5 ? weight1 : weight2;

                    graph[source][destination] = weight;
                    graph[destination][source] = weight;

                    edgesCount[sourceIndex]++;
                    edgesCount[destinationIndex]++;
                    edgesCreated++;
                }
            }

            drawCytoscapeGraph();
            document.getElementById('matrixBtn').classList.remove('hidden');
            document.getElementById('downloadBtn').classList.remove('hidden');
            isMatrixVisible = false;
            document.getElementById('matrixBtn').innerText = 'Show Matrix';
            document.getElementById('graphTable').classList.add('hidden');
        }

        function displayGraph() {
            const table = document.getElementById('graphTable');
            table.innerHTML = ''; 

            const headerRow = document.createElement('tr');
            headerRow.innerHTML = '<th></th>';
            for (let i = 0; i < Object.keys(graph).length; i++) {
                headerRow.innerHTML += `<th>${String.fromCharCode(65 + i)}</th>`;
            }
            table.appendChild(headerRow);

            for (const [vertex, edges] of Object.entries(graph)) {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${vertex}</td>`;
                for (const targetVertex of Object.keys(graph)) {
                    if (vertex === targetVertex) {
                        row.innerHTML += '<td>x</td>';
                    } else {
                        const weight = edges[targetVertex] !== undefined ? edges[targetVertex] : 'x';
                        row.innerHTML += `<td class="editable" contenteditable="true" onblur="updateWeight('${vertex}', '${targetVertex}', this.innerText)">${weight}</td>`;
                    }
                }
                table.appendChild(row);
            }
        }

        function toggleMatrix() {
            const table = document.getElementById('graphTable');
            const matrixBtn = document.getElementById('matrixBtn');

            if (isMatrixVisible) {
                table.classList.add('hidden');
                matrixBtn.innerText = 'Show Matrix';
            } else {
                displayGraph(); 
                table.classList.remove('hidden');
                matrixBtn.innerText = 'Hide Matrix';
            }

            isMatrixVisible = !isMatrixVisible;
        }

        function drawCytoscapeGraph() {
            const elements = [];

            for (const [source, edges] of Object.entries(graph)) {
                elements.push({ data: { id: source } });
                for (const [destination, weight] of Object.entries(edges)) {
                    if (source !== destination) {
                        elements.push({ data: { id: destination } });
                        elements.push({ data: { id: `${source}-${destination}`, source: source, target: destination, label: weight.toFixed(2) } });
                    }
                }
            }

            const cy = cytoscape({
                container: document.getElementById('cy'),
                elements: elements,
                style: [
                    {
                        selector: 'node',
                        style: {
                            'background-color': '#9E1B32',
                            'label': 'data(id)',
                            'color': '#FFF'
                        }
                    },
                    {
                        selector: 'edge',
                        style: {
                            'width': 2,
                            'line-color': '#FFC72C',
                            'label': 'data(label)',
                            'font-size': '10px',
                            'color': '#000'
                        }
                    }
                ],
                layout: {
                    name: 'grid',
                    rows: Math.ceil(Math.sqrt(Object.keys(graph).length)),
                }
            });
        }

        function downloadJSON() {
            const jsonStr = JSON.stringify(graph, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'graph.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function uploadJSON() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            if (!file) {
                alert("Please select a file to upload.");
                return;
            }

            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const json = JSON.parse(event.target.result);
                    graph = json;
                    displayGraph();
                    draw
                    drawCytoscapeGraph();
                    document.getElementById('downloadBtn').classList.remove('hidden');
                    document.getElementById('matrixBtn').classList.remove('hidden');
                } catch (e) {
                    alert("Error parsing JSON: " + e.message);
                }
            };
            reader.readAsText(file);
        }
    </script>
</body>
</html>
